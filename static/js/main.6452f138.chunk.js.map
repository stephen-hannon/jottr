{"version":3,"sources":["hooks.ts","Storage.ts","styles/flex.ts","components/Note.tsx","components/NoteList.tsx","utils.ts","components/Header.tsx","styles/theme.ts","styles/GlobalStyles.tsx","App.tsx","index.tsx"],"names":["useStoredState","storage","key","defaultValue","useState","getItem","value","setValue","useEffect","setItem","LocalStorage","namespace","this","window","localStorage","toString","namespacedKey","startsWith","replace","getNamespacedKey","undefined","JSON","parse","removeItem","stringifiedValue","stringify","flexRow","css","flexChild","NoteWrapper","styled","div","Header","Title","input","theme","duration","colors","gray","primary","Body","textarea","Note","data","deleteDisabled","moveUpDisabled","moveDownDisabled","onDelete","onMove","onChange","textRef","useRef","textHeight","setTextHeight","current","console","log","scrollHeight","Math","max","text","title","target","placeholder","disabled","onClick","ref","style","height","EMPTY_NOTE_DATA","reducer","state","action","type","newData","parameter","newValue","getInitialState","keys","forEach","NoteList","setKeys","nextKey","setNextKey","useReducer","dispatch","storageCallback","useCallback","event","oldValue","removeNamespace","keyNumber","Number","isNaN","addEventListener","removeEventListener","makeOnMove","index","direction","arr","fromInd","toInd","length","newArr","splice","move","map","filter","k","HeaderWrapper","h1","Nav","ul","NavItem","li","role","href","primaryLight","GlobalStyles","createGlobalStyle","App","rootElement","document","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.6452f138.chunk.js","sourcesContent":["import { useEffect, useState, Dispatch, SetStateAction } from 'react';\nimport LocalStorage from './Storage';\n\nexport function useStoredState<T>(\n  storage: LocalStorage,\n  key: string,\n  defaultValue: T\n): [T, Dispatch<SetStateAction<T>>] {\n  const [value, setValue] = useState<T>(() => {\n    return storage.getItem(key, defaultValue);\n  });\n\n  useEffect(() => {\n    storage.setItem(key, value);\n  }, [storage, key, value]);\n\n  return [value, setValue];\n}\n","// import { useEffect, useState } from 'react';\n\ntype KeyType = string | number;\n\nexport default class LocalStorage {\n  private namespace?: string;\n  private storage: Storage;\n\n  constructor(namespace?: string) {\n    this.namespace = namespace;\n    this.storage = window.localStorage;\n  }\n\n  getNamespacedKey(key: KeyType): string {\n    return this.namespace ? `${this.namespace}_${key}` : key.toString();\n  }\n\n  removeNamespace(namespacedKey: string): string {\n    if (!this.namespace || !namespacedKey.startsWith(`${this.namespace}_`)) {\n      return namespacedKey;\n    }\n    return namespacedKey.replace(`${this.namespace}_`, '');\n  }\n\n  getItem<T>(key: KeyType, defaultValue?: T) {\n    const value = this.storage.getItem(this.getNamespacedKey(key));\n    return value === null && defaultValue !== undefined\n      ? defaultValue\n      : JSON.parse(value as string);\n  }\n\n  removeItem(key: KeyType) {\n    this.storage.removeItem(this.getNamespacedKey(key));\n  }\n\n  setItem(key: KeyType, value: unknown) {\n    const stringifiedValue = JSON.stringify(value);\n    this.storage.setItem(this.getNamespacedKey(key), stringifiedValue);\n  }\n\n  // useStoredState(key, defaultValue) {\n  //   const [value, setValue] = useState(() => {\n  //     return this.getItem(key, defaultValue);\n  //   });\n\n  //   useEffect(() => {\n  //     this.setItem(key, value);\n  //   }, [key, value]);\n\n  //   return [value, setValue];\n  // }\n}\n","import { css } from 'styled-components';\n\nexport const flexRow = css`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nexport const flexChild = css`\n  flex: 1;\n`;\n","import React, { useRef, useEffect, useState } from 'react';\nimport styled from 'styled-components';\n\nimport { flexRow } from 'styles/flex';\nimport { NoteData } from 'types';\n\nconst MIN_BODY_HEIGHT = 150;\n\nconst NoteWrapper = styled.div`\n  border-radius: 10px;\n  box-shadow: 0 0 6px 0 #00000080;\n  margin: 4rem auto;\n  padding: 2rem;\n  max-width: 1000px;\n`;\n\nconst Header = styled.div`\n  ${flexRow}\n`;\n\nconst Title = styled.input`\n  display: block;\n  width: 100%;\n  border: none;\n  font-weight: bold;\n  font-size: 2rem;\n  border-bottom: 2px solid transparent;\n  transition: border-bottom-color linear ${({ theme }) => theme.duration}s;\n\n  &:hover {\n    border-bottom-color: ${({ theme }) => theme.colors.gray};\n  }\n\n  &:focus {\n    outline: none;\n    border-bottom-color: ${({ theme }) => theme.colors.primary};\n  }\n`;\n\nconst Body = styled.textarea`\n  font-family: 'Source Code Pro', Consolas, Monaco, monospace;\n  display: block;\n  width: 100%;\n  margin-top: 1.5rem;\n\n  &:not(:focus) {\n    height: ${MIN_BODY_HEIGHT}px !important;\n  }\n`;\n\ninterface ComponentProps {\n  data: NoteData;\n  deleteDisabled?: boolean;\n  moveUpDisabled?: boolean;\n  moveDownDisabled?: boolean;\n  onDelete?: (event: React.MouseEvent) => void;\n  onMove: (delta: number) => void;\n  onChange: (parameter: string, newValue: string) => void;\n}\n\nconst Note: React.FC<ComponentProps> = ({\n  data,\n  deleteDisabled,\n  moveUpDisabled,\n  moveDownDisabled,\n  onDelete,\n  onMove,\n  onChange,\n}) => {\n  const textRef = useRef<HTMLTextAreaElement>(null);\n  const [textHeight, setTextHeight] = useState<number>(150);\n\n  useEffect(() => {\n    if (!textRef.current) return;\n\n    console.log(textRef.current.scrollHeight);\n    setTextHeight(Math.max(textRef.current.scrollHeight, MIN_BODY_HEIGHT));\n  }, [data.text]);\n\n  return (\n    <NoteWrapper>\n      <Header>\n        <Title\n          value={data.title}\n          onChange={({ target }) => onChange('title', target.value)}\n          placeholder=\"Title\"\n        />\n        <button disabled={moveUpDisabled} onClick={() => onMove(-1)}>\n          ↑\n        </button>\n        <button disabled={moveDownDisabled} onClick={() => onMove(1)}>\n          ↓\n        </button>\n        <button disabled={deleteDisabled} onClick={onDelete}>\n          delete\n        </button>\n      </Header>\n      <Body\n        // TODO: Autofocus first textarea on page load\n        ref={textRef}\n        style={{ height: textHeight }}\n        value={data.text}\n        placeholder=\"Start typing...\"\n        onChange={({ target }) => onChange('text', target.value)}\n      />\n    </NoteWrapper>\n  );\n};\n\nexport default Note;\n","import React, { useReducer, useEffect, useCallback } from 'react';\n\nimport { useStoredState } from 'hooks';\nimport { move } from 'utils';\nimport { NoteData } from 'types';\nimport LocalStorage from 'Storage';\nimport Note from './Note';\n\nconst EMPTY_NOTE_DATA: NoteData = {\n  title: '',\n  text: '',\n};\n\nconst storage = new LocalStorage('jottr');\n\ninterface NoteState {\n  [key: number]: NoteData;\n}\n\ntype NoteAction =\n  | {\n      type: 'change';\n      key: number;\n      parameter: string;\n      value: string;\n    }\n  | {\n      type: 'delete';\n      key: number;\n    }\n  | {\n      type: 'delete_sync';\n      key: number;\n    }\n  | {\n      type: 'change_sync';\n      key: number;\n      newValue: NoteData;\n    };\n\nfunction reducer(state: NoteState, action: NoteAction) {\n  switch (action.type) {\n    case 'change':\n      const newData: NoteData = {\n        ...EMPTY_NOTE_DATA,\n        ...state[action.key],\n        [action.parameter]: action.value,\n      };\n      storage.setItem(action.key, newData);\n      return {\n        ...state,\n        [action.key]: newData,\n      };\n    case 'change_sync':\n      return {\n        ...state,\n        [action.key]: action.newValue,\n      };\n    case 'delete':\n      storage.removeItem(action.key);\n    // fall through\n    case 'delete_sync':\n      const { [action.key]: _deleted, ...rest } = state;\n      return rest;\n  }\n}\n\nfunction getInitialState(keys: number[]): NoteState {\n  console.log('gis', keys);\n  const state: NoteState = {};\n  keys.forEach((key) => {\n    state[key] = storage.getItem<number>(key);\n  });\n  return state;\n}\n\nexport default function NoteList() {\n  const [keys, setKeys] = useStoredState<number[]>(storage, 'keys', []);\n  const [nextKey, setNextKey] = useStoredState(storage, 'nextKey', 0);\n  const [state, dispatch] = useReducer(reducer, keys, getInitialState);\n\n  useEffect(() => {\n    storage.setItem('version', 1); // will be helpful if the API ever changes\n  }, []);\n\n  const storageCallback = useCallback(\n    (event: StorageEvent) => {\n      if (event.newValue === event.oldValue) {\n        // No change\n        return;\n      }\n      if (event.key == null) {\n        // TODO: handle clearing storage\n        return;\n      }\n\n      const key = storage.removeNamespace(event.key);\n      const keyNumber = Number(key);\n      if (key === 'keys' && event.newValue) {\n        setKeys(JSON.parse(event.newValue));\n      } else if (key === 'nextKey' && event.newValue) {\n        setNextKey(JSON.parse(event.newValue));\n      } else if (!isNaN(keyNumber)) {\n        if (event.newValue === null) {\n          dispatch({\n            type: 'delete_sync',\n            key: keyNumber,\n          });\n        } else {\n          if (event.oldValue === null) {\n            setNextKey(nextKey + 1);\n          }\n          dispatch({\n            type: 'change_sync',\n            key: keyNumber,\n            newValue: JSON.parse(event.newValue),\n          });\n        }\n      }\n    },\n    [setKeys, setNextKey, nextKey]\n  );\n\n  useEffect(() => {\n    window.addEventListener('storage', storageCallback);\n\n    return () => {\n      window.removeEventListener('storage', storageCallback);\n    };\n  }, [storageCallback]);\n\n  const makeOnMove = (index: number) => (direction: number) => {\n    setKeys(move(keys, index, index + direction));\n  };\n\n  return (\n    <>\n      {[nextKey, ...keys].map((key, index) => (\n        <Note\n          key={key}\n          data={state[key] || EMPTY_NOTE_DATA}\n          moveUpDisabled={index <= 1}\n          moveDownDisabled={index === 0 || index === keys.length}\n          deleteDisabled={index === 0}\n          onMove={makeOnMove(index - 1)}\n          onChange={(parameter, value) => {\n            if (index === 0) {\n              setKeys([nextKey, ...keys]);\n              setNextKey(nextKey + 1);\n            }\n            dispatch({ type: 'change', key, value, parameter });\n          }}\n          onDelete={() => {\n            setKeys(keys.filter((k) => k !== key));\n            dispatch({ type: 'delete', key });\n          }}\n        />\n      ))}\n    </>\n  );\n}\n","export function move<T>(arr: T[], fromInd: number, toInd: number): T[] {\n  if (toInd < 0 || toInd >= arr.length) return arr;\n\n  const newArr = [...arr];\n  const value = newArr.splice(fromInd, 1)[0];\n  newArr.splice(toInd, 0, value);\n  return newArr;\n}\n","import React from 'react';\nimport styled from 'styled-components';\nimport { flexRow, flexChild } from 'styles/flex';\n\nconst HeaderWrapper = styled.div`\n  ${flexRow}\n  color: ${({ theme }) => theme.colors.primary};\n  padding: 1.5rem 3rem;\n`;\n\nconst Title = styled.h1`\n  ${flexChild}\n  margin: 0;\n`;\n\nconst Nav = styled.ul`\n  list-style: none;\n  padding: 0;\n  margin: 0;\n`;\n\nconst NavItem = styled.li`\n  display: inline-block;\n`;\n\nconst Header: React.FC = () => (\n  <HeaderWrapper>\n    <Title>Jottr</Title>\n    <Nav role=\"navigation\">\n      <NavItem>\n        <a href=\"https://github.com/stephen-hannon/jottr\">Source code</a>\n      </NavItem>\n    </Nav>\n  </HeaderWrapper>\n);\n\nexport default Header;\n","import { DefaultTheme } from 'styled-components';\n\nconst theme: DefaultTheme = {\n  colors: {\n    gray: '#e0e0e0',\n    primary: '#ab47bc',\n    primaryLight: '#df78ef',\n    text: '#000',\n  },\n  duration: 0.1,\n};\n\nexport default theme;\n","import { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n* {\n  box-sizing: border-box;\n}\n\nhtml {\n  /* Make 1rem == 10px on typical browsers */\n  font-size: ${(10 / 16) * 100}%;\n  font-family: 'Source Sans Pro', sans-serif;\n}\n\nbody {\n  font-size: 1.6rem;\n  margin: 0;\n}\n\ninput,\nbutton {\n  font-family: inherit;\n}\n`;\n\nexport default GlobalStyles;\n","import React from 'react';\nimport { ThemeProvider } from 'styled-components';\n\nimport NoteList from 'components/NoteList';\nimport Header from 'components/Header';\nimport theme from 'styles/theme';\nimport GlobalStyles from 'styles/GlobalStyles';\n\nexport default function App() {\n  return (\n    <ThemeProvider theme={theme}>\n      <>\n        <GlobalStyles />\n        <Header />\n        <NoteList />\n      </>\n    </ThemeProvider>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nconst rootElement = document.getElementById('root');\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}